{
  "app-id": "com.github.vladimiry.ElectronMail",
  "base": "org.electronjs.Electron2.BaseApp",
  "base-version": "19.08",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "19.08",
  "sdk": "org.freedesktop.Sdk",
  "branch": "beta",
  "separate-locales": false,
  "command": "electron-mail",
  "rename-desktop-file": "electron-mail.desktop",
  "rename-icon": "electron-mail",
  "finish-args": [
    "--device=dri",
    "--env=HUNSPELL_DICTIONARIES=/app/ElectronMail/usr/share/hunspell/",
    "--filesystem=xdg-download",
    "--share=ipc",
    "--share=network",
    "--socket=pulseaudio",
    "--socket=x11",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.freedesktop.secrets",
    "--talk-name=org.kde.StatusNotifierWatcher"
  ],
  "modules": [
    "shared-modules/libsecret/libsecret.json",
    {
      "name": "squashfs",
      "buildsystem": "simple",
      "build-commands": [
        "XZ_SUPPORT=1 make -C squashfs-tools -j ${FLATPAK_BUILDER_N_JOBS} install INSTALL_DIR=${FLATPAK_DEST}/bin"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/plougher/squashfs-tools.git",
          "commit": "c570c6188811088b12ffdd9665487a2960c997a0"
        }
      ]
    },
    {
      "name": "electron-mail",
      "buildsystem": "simple",
      "build-commands": [
        "unsquashfs -dest /app/ElectronMail/ electron-mail.snap -e usr/share/hunspell/",
        "rm electron-mail.snap",
        "ar xo electron-mail.deb",
        "tar xf data.tar.xz -C /app --strip-components=2 ./opt ./usr",
        "rm -f control.tar.gz data.tar.xz debian-binary electron-mail.deb",
        "rm -rf /app/share/icons/hicolor/1024x1024/",
        "install -Dm755 electron-mail-entrypoint.sh /app/bin/electron-mail",
        "chmod -R a-s,go+rX,go-w /app/ElectronMail",
        "desktop-file-edit --set-key=Exec --set-value=\"/app/bin/electron-mail --js-flags=\\\"--max-old-space-size=6144\\\" %U\" /app/share/applications/electron-mail.desktop",
        "install -Dm644 -t /app/share/metainfo ${FLATPAK_ID}.metainfo.xml"
      ],
      "sources": [
        {
          "type": "file",
          "dest-filename": "electron-mail.snap",
          "url": "https://github.com/vladimiry-playground/electron-mail-ftatpak/releases/download/4.8.1-debug/electron-mail-4.8.1-debug-linux-amd64.snap",
          "sha256": "89e019e3afafac3dd7b1d3d73f6e6cb1fce928055daf82b019cfb733cb7d97fa"
        },
        {
          "type": "file",
          "dest-filename": "electron-mail.deb",
          "url": "https://github.com/vladimiry-playground/electron-mail-ftatpak/releases/download/4.8.1-debug/electron-mail-4.8.1-debug-linux-amd64.deb",
          "sha256": "cc38ad3e2ca70112761a10daf179b5e59666321acdacbaf9bfaa928e943de6d6"
        },
        {
          "type": "script",
          "dest-filename": "electron-mail-entrypoint.sh",
          "commands": [
            "export TMPDIR=\"$XDG_RUNTIME_DIR/app/${FLATPAK_ID}\"",
            "exec zypak-wrapper /app/ElectronMail/electron-mail \"$@\""
          ]
        },
        {
          "type": "file",
          "path": "com.github.vladimiry.ElectronMail.metainfo.xml"
        }
      ]
    }
  ]
}
